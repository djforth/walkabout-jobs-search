{"version":3,"sources":["../../src/stores/filter_store.js"],"names":[],"mappings":"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","file":"filter_store.js","sourcesContent":["const _ = require(\"lodash\");\n\nconst FilterDispatcher = require(\"../dispatcher/filter_dispatcher\");\nconst FilterAction     = require(\"../actions/filter_actions\");\nconst EventEmitter     = require(\"events\").EventEmitter;\nconst assign           = require(\"react/lib/Object.assign\");\n\nconst AjaxPromises  = require(\"ajax-es6-module\");\nlet ajaxPromises    = new AjaxPromises();\n\nconst FiltersFcty = require(\"../factories/filters_fcty\");\n\n// let Masterfilters =  new FiltersFcty();\n\n\n\nconst store =  {\n  keys         : [],\n  dates        : {},\n  selectedKey  : \"all\",\n  filters      : [],\n  changed      : true,\n  cache        : null,\n  tabs         : [],\n\n  emitChange(event) {\n    this.emit(event);\n  },\n\n  /**\n   * @param {function} callback\n   */\n  addChangeListener(event, callback) {\n    this.on(event, callback);\n  },\n\n  removeChangeListener(event, callback) {\n    this.removeListener(event, callback);\n  },\n\n  checked(filterBy, id, checked){\n    let filter = this.get(filterBy);\n\n    if(filter){\n      filter.setSelected(id, checked);\n    }\n    this.changed  = true;\n  },\n\n  fetchData(api){\n    this.setApi(api);\n    return ajaxPromises.fetch().then((data)=>{\n      this.filters = this.processFilters(data);\n      FilterAction.receiveAll(this.filters);\n      return this.filters;\n    }).catch((err)=>{\n      throw new Error(err);\n    });\n  },\n\n  get(id) {\n    return _.find(this.filters, (f)=>{\n      return f.hasDetails(\"filterBy\", id);\n    });\n  },\n\n  getAll() {\n    return this.filters;\n  },\n\n  getDates() {\n    return this.dates;\n  },\n\n  getAllKeys() {\n    return this.keys;\n  },\n\n  getFilters(){\n    let data = this.cache;\n    if(this.changed) {\n\n      this.cache =  data = this.getSelectedFilters();\n      this.changed = false;\n    }\n    return data;\n  },\n\n  getSelectedFilters(){\n    return _.map(this.filters, (f)=>{\n      return f.getSelected();\n    });\n  },\n\n  getSelectedKey(){\n\n    return this.selectedKey;\n  },\n\n  getSelectedKeys(){\n    if(this.selectedKey === \"all\"){\n      return this.keys;\n    } else {\n      return [this.selectedKey];\n    }\n  },\n\n  getVisible(){\n    return _.filter(this.filters, (f)=>{\n      return f.isVisible();\n    });\n  },\n\n  isSelectedKey(k){\n    return this.selectedKey === k;\n  },\n\n  setDate(dr){\n    if(!_.has(this.dates, dr.key)){\n      this.dates[dr.key] = {};\n    }\n\n    if(dr.pos === \"start\"){\n      this.dates[dr.key].st = dr.date;\n    } else {\n      this.dates[dr.key].fn = dr.date;\n    }\n  },\n\n  setKeys(ks){\n    this.keys = ks;\n  },\n\n  // setTabFilter(tab){\n\n  // }\n\n  setTab(tab){\n\n    this.tab     = tab;\n    this.changed = true;\n    if(!_.isEmpty(this.filters)){\n      this.filters = _.map(this.filters, (filter)=>{\n        // console.log('filters', tab.filters);\n        filter.reset();\n        filter.setVisible(tab.filters);\n        return filter;\n      });\n\n\n    }\n  },\n\n  processFilters(data){\n    return _.map(data, (d)=>{\n      let fcty = new FiltersFcty(d.title, d.filter_by, d.filter_options, d.input_type);\n      fcty.setSelected(\"all\", true);\n\n      if(this.tab){\n        fcty.setVisible(this.tab.filters);\n      }\n\n      return fcty;\n    });\n  },\n\n  selected(filterBy, id, val=true){\n    let filter = this.get(filterBy);\n    // console.log(filterBy, id)\n    filter.setSelected(id, val, true);\n    this.changed  = true;\n  },\n\n  setSelected(sel){\n    this.selectedKey = sel;\n  },\n\n  setApi(uri){\n    ajaxPromises.addUrl(uri);\n  }\n\n};\n\nconst FilterStore = assign({}, EventEmitter.prototype, store);\nFilterStore.setMaxListeners(0);\n\nconst registeredCallback = function(payload) {\n  var action = payload.action;\n  switch(action.type) {\n\n    case \"CHANGE_DATE\":\n      FilterStore.setDate(action);\n      FilterStore.emitChange(\"change_date\");\n      break;\n\n    case \"CHANGE_KEY\":\n      FilterStore.setSelected(action.data);\n      FilterStore.emitChange(\"change_key\");\n      break;\n\n\n    case \"CHECK_FILTER\":\n      // _data = action.data;\n      FilterStore.checked(action.filterBy, action.id, action.value);\n      FilterStore.emitChange(\"filter_change\");\n      break;\n\n    case \"FETCH\":\n      // FilterStore.setApi(action.api);\n      FilterStore.fetchData(action.api);\n      FilterStore.emitChange(\"fetching\");\n      break;\n\n    case \"RECEIVE_DATA\":\n      // _data = action.data;\n      FilterStore.emitChange(\"fetched\");\n      break;\n\n    case \"SELECT_FILTER\":\n      // _data = action.data;\n      FilterStore.selected(action.filterBy, action.id);\n      FilterStore.emitChange(\"filter_change\");\n      break;\n\n    case \"SET_KEYS\":\n      FilterStore.setKeys(action.data);\n      FilterStore.emitChange(\"setting_keys\");\n      break;\n\n    case \"SET_TAB\":\n      FilterStore.setTab(action.tab);\n      FilterStore.emitChange(\"set_tab\");\n      break;\n  }\n};\n\n\nFilterStore.dispatchToken = FilterDispatcher.register(registeredCallback);\nmodule.exports = FilterStore;\n"]}